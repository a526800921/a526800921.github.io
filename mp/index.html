<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>公司在小程序方面好像都只是浅尝辄止？ | 项目文档</title>
    <meta name="description" content="项目文档">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/sx-readme/assets/css/0.styles.bd7b7787.css" as="style"><link rel="preload" href="/sx-readme/assets/js/app.81b75d51.js" as="script"><link rel="preload" href="/sx-readme/assets/js/2.9a3dd2cd.js" as="script"><link rel="preload" href="/sx-readme/assets/js/9.b885d552.js" as="script"><link rel="prefetch" href="/sx-readme/assets/js/10.f1818486.js"><link rel="prefetch" href="/sx-readme/assets/js/11.4e950798.js"><link rel="prefetch" href="/sx-readme/assets/js/12.b406d258.js"><link rel="prefetch" href="/sx-readme/assets/js/3.5a23f80c.js"><link rel="prefetch" href="/sx-readme/assets/js/4.90160e26.js"><link rel="prefetch" href="/sx-readme/assets/js/5.75c2e8ec.js"><link rel="prefetch" href="/sx-readme/assets/js/6.e8a0a69d.js"><link rel="prefetch" href="/sx-readme/assets/js/7.2210c711.js"><link rel="prefetch" href="/sx-readme/assets/js/8.7baa99a5.js">
    <link rel="stylesheet" href="/sx-readme/assets/css/0.styles.bd7b7787.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sx-readme/" class="home-link router-link-active"><!----> <span class="site-name">项目文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/sx-readme/guide/" class="sidebar-link">指南</a></li><li><a href="/sx-readme/npm/" class="sidebar-link">npm包</a></li><li><a href="/sx-readme/h5/" class="sidebar-link">H5</a></li><li><a href="/sx-readme/mp/" class="active sidebar-link">小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sx-readme/mp/#公司在小程序方面好像都只是浅尝辄止？" class="sidebar-link">公司在小程序方面好像都只是浅尝辄止？</a></li><li class="sidebar-sub-header"><a href="/sx-readme/mp/#头条小程序" class="sidebar-link">头条小程序</a></li></ul></li><li><a href="/sx-readme/kyy/" class="sidebar-link">快应用</a></li><li><a href="/sx-readme/other/" class="sidebar-link">其他</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="公司在小程序方面好像都只是浅尝辄止？"><a href="#公司在小程序方面好像都只是浅尝辄止？" class="header-anchor">#</a> 公司在小程序方面好像都只是浅尝辄止？</h2> <blockquote><p>项目地址：美阅读</p></blockquote> <p>这个项目在框架层次近乎没有，状态管理也只是一个 globalData，使用起来非常不便。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>ticket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> imgurl <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>user<span class="token punctuation">.</span>icon<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        ticket<span class="token operator">:</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>ticket<span class="token punctuation">,</span>
        imgUrl<span class="token operator">:</span> string<span class="token punctuation">.</span><span class="token function">computedImagePath</span><span class="token punctuation">(</span>imgurl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于页面的管理也是自己页面只处理自己页面的事情，导致了很多不必要的操作(其实也是无状态管理引起的)，
对于路由的管理也没有(可能是因为当时没有埋点需求？)，这里也不再赘述。</p> <p>小程序的项目到后来也是通过 gulp 进行文件后缀的替换，内容关键字的替换，达到多平台的目的(确实当时的第三方框架都挺差劲)，
但是小程序做了这么多，好像也没有怎么去推广(或者说推广了也没见到什么收益？)，之后也就不了了之。</p> <p>下一个。</p> <h2 id="头条小程序"><a href="#头条小程序" class="header-anchor">#</a> 头条小程序</h2> <blockquote><p>项目地址：头条小程序</p></blockquote> <p>项目创建时间比较近(19年11月左右)，大家都愿意尝试使用 react 来编写，
之后使用了 taro(其实我开始是不太看好第三方，但后面写下来发现第三方确实也相对成熟了)，
react 出了一个 HOOK 功能，使函数式组件也有 class 组件的功能(渲染完成、数据更新等)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>从而大大的减小了项目复杂度，不再需要一堆 connect、class 重复的垃圾代码，变得更加直观。</p> <p>由于仅参与了项目初期的建设，对于该项目的理解仅存在初期阶段，
当时使用了轻量的状态库 laco，通过订阅(subscribe)的方式通知视图更新。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 通过 useEffect 来做订阅与取消订阅
 * @param {Store} store - laco 的 store 实例
 * @param {String} key - 需要本地存储的 key
  */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token operator">:</span> Params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">updateState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 有key时做缓存处理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> Taro<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token function">getKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setState</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里做一次更新是为了防止在初始化到订阅之间的时候，store被修改</span>
        <span class="token function">updateState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// 在这里进行订阅</span>
        store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>updateState<span class="token punctuation">)</span>
        <span class="token comment">// 在销毁时取消订阅</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span>updateState<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是该项目把状态的管理分成了多个目录分开处理，导致新增一个方法需要在多个目录下面进行修改(或者说这里其实还有着redux的影子)，
其实这是没有必要的，store 的创建和修改完全可以写在一起，因为多个模块文件(book.ts home.ts)已经达到了分块的目的了，如果还要细分，可以继续创建模块文件。
这里的缓存其实也可以通过订阅来做，所以是有优化空间的。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">4/3/2020, 8:11:34 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sx-readme/h5/" class="prev">
        H5
      </a></span> <span class="next"><a href="/sx-readme/kyy/">
        快应用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sx-readme/assets/js/app.81b75d51.js" defer></script><script src="/sx-readme/assets/js/2.9a3dd2cd.js" defer></script><script src="/sx-readme/assets/js/9.b885d552.js" defer></script>
  </body>
</html>
